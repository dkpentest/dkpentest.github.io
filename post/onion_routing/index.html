<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Onion_routing | drunk for pentest</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="stylesheet" href="/css/bundle.css">
	<link rel="icon" href="/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="/icons/32.png" sizes="32x32" type="image/png">
		
</head>
<body class="body kind-page">
	<header class="header">
	<a class="logo" href="/">drunk for pentest</a>
	
</header>
	<div class="primary">
	
	<main class="main">
		
		<div class="single block">
			<article class="entry">
				<h1 class="entry__title">Onion_routing</h1>
				<div class="entry__content"><h3 id="tor-洋葱路由">Tor 洋葱路由</h3>
<p>浅析著名的洋葱路由。</p>
<hr>
<h5 id="0x0-原理">0x0 原理</h5>
<p>Tor是一种著名的匿名工具，一个开源项目，一个Onion Routing软件，历史上1995年提出，最初由美国海军研究办公室资助，陆陆续续经过许多赞助商，最近reddit也参了一脚。之所以叫它“洋葱路由”，是因为它基于保持隐私和匿名网络的一种“信仰”，基于不信任的原则进行了层层加密。</p>
<pre tabindex="0"><code>Tor规范：https://gitweb.torproject.org/torspec.git/tree/
</code></pre><p>简单来说，访问者和目的地之间，隔着三层路由中继网络（目前世界上大概有6000个志愿者中继器）。</p>
<p>【访问者】-【guard relay】-【middle relay】-【exit relay】-【目的地】</p>
<p>访问者的请求流量经过三层加密，</p>
<ul>
<li>第一层加密：只有 exit relay 能解密出 目的地</li>
<li>第二层加密：只有 middle relay 能解密出 exit relay</li>
<li>第三层加密：只有 guard relay 能解密出 middle relay</li>
</ul>
<p>因此，在最初的设计中，三层中继的节点清单本身是公开的。</p>
<hr>
<h5 id="0x1-oppressive-government">0x1 Oppressive Government</h5>
<p>那么问题来了，我们假设有个攻击者叫OG，他不希望你使用匿名网络，他可以怎么做？如果所有的中继服务器地址是公开的，那么他可以选择在中继入口和出口阻塞流量。因此诞生了 BridgeDB ，即网桥。通过每次只向访问者公开一小部分的 guard relay 中继器，使OG不能同时瘫痪所有入口。</p>
<p>整个Tor网络，有10个特殊的中继器，叫做DA（directory authorities），负责整个网络的运行，其中九个负责分发所有已知的Tor中继器主列表，还有一个DA（Tonga）维持网桥的主列表。</p>
<p>所有的中继器变更等信息都由九个DA共同维护一个共识文档（consensus），任何改动都由DA发起并投票每小时表决一次后，经所有DA签名发布在各自共同维护的共识文档中（有点区块链的意思）</p>
<pre tabindex="0"><code>http://directory_authority/tor/status-vote/current/consensus/.tor26
</code></pre><hr>
<h5 id="0x2-部署tor">0x2 部署Tor</h5>
<p>首先，部署Tor相当于涉入一个对抗激烈而危险的地方，不要用这个服务器做任何事情，任何可以暴露自身身份的事情，不要使用任何VPS提供商提供的服务，不要在这台服务器上公开Tor中继（你将会被公开在全世界暗网上），谨慎使用任何javascript、web前端代码</p>
<p>第一步，部署和配置nginx（或者appache/lighttp whatever you like）</p>
<pre tabindex="0"><code>apt-get install nginx //下载安装
sudo vim /etc/nginx/sites-available/default
    server {
        listen 127.0.0.1:8080
        ...
    }
sudo service nginx restart //用curl访问下 http://localhost:8080 看看跑通没有
</code></pre><p>第二部，安装Tor，官方教程在此：https://www.torproject.org/docs/debian.html.en</p>
<pre tabindex="0"><code>sudo vi /etc/apt/sources.list   //用vi编辑源的配置文件
    deb     http://deb.torproject.org/torproject.org  main //添加这么一行
sudo gpg –keyserver keys.gnupg.net –recv 886DDD89
sudo gpg –export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | sudo apt-key add –
sudo apt-get install deb.torproject.org-keyring
sudo apt-get install tor

vi /etc/tor/torrc //安装完成后更改配置
HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:8080
sudo service tor start //独一无二的 xxx.onion域名就创建好了
cd /var/lib/tor/hidden_service/
# ls
hostname private_key //可以试试浏览器访问这个 xxx.onion 域名 welcome
</code></pre><hr>
<h5 id="0x3-onionscan">0x3 OnionScan</h5>
<p>暗网中的浅层网可以轻松通过Tor浏览器访问，通过OnionScan可以扫描运行中的.onion服务，寻找“丝绸之路”（一个封了N次复活N次的著名加密货币交易黑市）&hellip;</p>
<p>HTTP：//reloadedudjtjvxr.onion</p></div>
				
			</article>
		</div>
	</main>
	
	



	

	</div>
	<footer class="footer">
	<div class="footer__copyright">© 2024 drunk for pentest. <span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span></div>
</footer>
</body>
</html>